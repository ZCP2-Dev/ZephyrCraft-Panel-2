# ANSI 控制字符支持说明

## 概述

ZephyrCraft Panel 2 现在支持完整的ANSI转义序列，包括颜色、格式和控制字符。

## 支持的控制字符

### 1. 颜色和格式 (ESC[...m)

#### 基本颜色
- `ESC[30m` - 黑色前景
- `ESC[31m` - 红色前景
- `ESC[32m` - 绿色前景
- `ESC[33m` - 黄色前景
- `ESC[34m` - 蓝色前景
- `ESC[35m` - 紫色前景
- `ESC[36m` - 青色前景
- `ESC[37m` - 白色前景

#### 背景颜色
- `ESC[40m` - 黑色背景
- `ESC[41m` - 红色背景
- `ESC[42m` - 绿色背景
- `ESC[43m` - 黄色背景
- `ESC[44m` - 蓝色背景
- `ESC[45m` - 紫色背景
- `ESC[46m` - 青色背景
- `ESC[47m` - 白色背景

#### 高亮颜色
- `ESC[90m` - 亮黑色前景
- `ESC[91m` - 亮红色前景
- `ESC[92m` - 亮绿色前景
- `ESC[93m` - 亮黄色前景
- `ESC[94m` - 亮蓝色前景
- `ESC[95m` - 亮紫色前景
- `ESC[96m` - 亮青色前景
- `ESC[97m` - 亮白色前景

#### 高亮背景
- `ESC[100m` - 亮黑色背景
- `ESC[101m` - 亮红色背景
- `ESC[102m` - 亮绿色背景
- `ESC[103m` - 亮黄色背景
- `ESC[104m` - 亮蓝色背景
- `ESC[105m` - 亮紫色背景
- `ESC[106m` - 亮青色背景
- `ESC[107m` - 亮白色背景

#### 文本格式
- `ESC[0m` - 重置所有属性
- `ESC[1m` - 粗体
- `ESC[2m` - 暗淡
- `ESC[3m` - 斜体
- `ESC[4m` - 下划线
- `ESC[5m` - 闪烁
- `ESC[7m` - 反显
- `ESC[8m` - 隐藏
- `ESC[9m` - 删除线

#### 256色模式
- `ESC[38;5;Xm` - 256色前景 (X = 0-255)
- `ESC[48;5;Xm` - 256色背景 (X = 0-255)

#### RGB真彩色
- `ESC[38;2;R;G;Bm` - RGB前景色
- `ESC[48;2;R;G;Bm` - RGB背景色

### 2. 光标控制字符

#### 光标移动
- `ESC[nC` - 光标向右移动n个字符
- `ESC[nD` - 光标向左移动n个字符
- `ESC[nA` - 光标向上移动n行
- `ESC[nB` - 光标向下移动n行
- `ESC[n;mH` - 光标定位到第n行第m列

#### 清除操作
- `ESC[K` - 清除从光标到行尾
- `ESC[1K` - 清除从行首到光标
- `ESC[2K` - 清除整行
- `ESC[J` - 清除从光标到屏幕末尾
- `ESC[1J` - 清除从屏幕开头到光标
- `ESC[2J` - 清除整个屏幕

## 实现说明

### 前端处理
- 颜色和格式代码转换为CSS样式
- 光标移动命令在HTML中转换为空格
- 清除命令在HTML中忽略（因为每行独立显示）

### 特殊处理
- `ESC[K` (清除行) - 在HTML中忽略，因为每行都是独立的
- `ESC[nC` (光标右移) - 转换为n个空格字符
- `ESC[nD` (光标左移) - 在HTML中忽略
- `ESC[nA/B` (光标上下移动) - 在HTML中忽略
- `ESC[n;mH` (光标定位) - 在HTML中忽略
- `ESC[J]` (清除屏幕) - 在HTML中忽略

## 测试命令

### 基本颜色测试
```bash
echo -e "\u001b[31m红色\u001b[0m \u001b[32m绿色\u001b[0m \u001b[33m黄色\u001b[0m"
```

### 控制字符测试
```bash
# 清除行
echo -e "文本\u001b[K清除行"

# 光标移动
echo -e "开始\u001b[10C中间\u001b[10C结束"

# 组合测试
echo -e "\u001b[31m红色\u001b[10C\u001b[32m绿色\u001b[0m"
```

### 256色测试
```bash
echo -e "\u001b[38;5;9m256色红色\u001b[0m"
echo -e "\u001b[48;5;12m256色背景\u001b[0m"
```

### RGB颜色测试
```bash
echo -e "\u001b[38;2;255;100;100mRGB红色\u001b[0m"
echo -e "\u001b[38;2;100;255;100mRGB绿色\u001b[0m"
echo -e "\u001b[38;2;100;100;255mRGB蓝色\u001b[0m"
```

## 注意事项

1. **HTML限制**: 某些ANSI控制字符在HTML中无法完全实现，如光标定位
2. **行独立性**: 每行文本在HTML中独立显示，因此清除行等操作会被忽略
3. **空格处理**: 光标右移命令会转换为空格字符
4. **兼容性**: 支持Windows 10+ CMD的所有ANSI功能

## 故障排除

### 颜色不显示
- 检查ANSI转义序列格式是否正确
- 确认终端组件正确加载
- 查看浏览器控制台错误

### 控制字符不工作
- 某些控制字符在HTML中会被忽略
- 光标移动命令会转换为空格
- 清除命令在HTML中无效

### 性能问题
- 大量ANSI序列可能影响性能
- 建议限制输出行数
- 定期清理历史记录 